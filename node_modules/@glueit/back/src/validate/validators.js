const store = require('../store')

module.exports = {
  type: ({ value, definition }) => {
    if (definition.type === 'array') {
      return Array.isArray(value)
    }
    if (typeof value === 'undefined') {
      return true
    }
    return typeof value === definition.type
  },
  required: ({ value, definition }) => {
    if (!definition.required) {
      return true
    }
    return typeof value !== 'undefined'
  },
  not_exits: async ({ objectName, name, value, definition }) => {
    if (!definition.notExists) {
      return true
    }
    const result = await store.get({
      query: '',
      name: objectName,
      id: value,
      idName: name
    })
    return Array.isArray(result)
  },
  exists: async ({ objectName, name, value, definition }) => {
    if (!definition.exists) {
      return true
    }
    const result = await store.get({
      query: '',
      name: objectName,
      id: value,
      idName: name
    })
    return !Array.isArray(result)
  }
}
