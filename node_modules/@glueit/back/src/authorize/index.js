// TODO: allow for custom authorizers

const authorizers = {
  isLoggedIn: require('./isLoggedIn'),
  notLoggedIn: require('./notLoggedIn'),
  hasVerifiedEmail: require('./hasVerifiedEmail'),
  notVerifiedEmail: require('./notVerifiedEmail'),
  isOwnerOfObject: require('./isOwnerOfObject')
}

const run = async ({ context, pathDefn, store, name, idName, id, object }) => {
  const authorize = pathDefn.back && pathDefn.back.authorize
  if (Array.isArray(authorize)) {
    for (let index in authorize) {
      const authorizer = authorizers[authorize[index]]
      const result = await authorizer({
        context,
        pathDefn,
        store,
        name,
        idName,
        id,
        object
      })
      if (!result) {
        return false
      }
    }
  }
  return true
}

module.exports = run
