const SecretsManager = require('aws-sdk/clients/secretsmanager')

const awsSecrets = async ({ region, secretName }) => {
  const storeConfig = await new Promise((res, rej) => {
    const client = new SecretsManager({
      region: region
    })
    client.getSecretValue({ SecretId: secretName }, (err, data) => {
      if (err) {
        rej(err)
      } else {
        const secret = JSON.parse(data.SecretString)
        res({
          adapter: secret.engine,
          config: {
            user: secret.username,
            password: secret.password,
            database: secret.dbname,
            host: secret.host,
            port: secret.port
          }
        })
      }
    })
  })
  return storeConfig
}

module.exports = awsSecrets
